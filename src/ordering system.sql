DELIMITER $$
CREATE TRIGGER BOOK_BEFORE_UPDATE
BEFORE UPDATE ON BOOK
FOR EACH ROW
BEGIN
  IF NEW.CATEGORY NOT IN ('Science','Art','Religion','History','Geography') 
  THEN
   SIGNAL SQLSTATE '02000' SET MESSAGE_TEXT = 'ERROR: INCOMPATIBLE DOMAIN';
  END IF;
  IF NEW.AMOUNT_IN_STOCK < 0
  THEN
	SIGNAL SQLSTATE '02000' SET MESSAGE_TEXT = 'ERROR: AMOUNT IN STOCK MUST BE POSITIVE';
  END IF;
END$$
    DELIMITER ;
    


DELIMITER $$
CREATE TRIGGER BOOK_BEFORE_INSERT
BEFORE INSERT ON BOOK
FOR EACH ROW
BEGIN
  IF NEW.CATEGORY NOT IN ('Science','Art','Religion','History','Geography') 
  THEN
   SIGNAL SQLSTATE '02000' SET MESSAGE_TEXT = 'ERROR: INCOMPATIBLE DOMAIN';
  END IF;
END$$
    DELIMITER ;
    

DELIMITER $$
CREATE TRIGGER BOOK_AFTER_INSERT
AFTER INSERT ON BOOK
FOR EACH ROW
BEGIN
  IF NEW.AMOUNT_IN_STOCK < NEW.THRESHOLD
   THEN
    INSERT INTO ORDERS (ISBN, QUANTITY, ORDER_DATE) VALUES(NEW.ISBN, 200, curdate());
   END IF;
END$$
    DELIMITER ;
    
DELIMITER $$
CREATE TRIGGER BOOK_AFTER_UPDATE
AFTER UPDATE ON BOOK
FOR EACH ROW
BEGIN
  IF NEW.AMOUNT_IN_STOCK < NEW.THRESHOLD
  THEN
	INSERT INTO ORDERS (ISBN, QUANTITY, ORDER_DATE) VALUES(NEW.ISBN, 200, curdate());
  END IF;
END$$
    DELIMITER ;

DELIMITER $$
CREATE TRIGGER ORDERS_BEFORE_DELETION
BEFORE DELETE ON ORDERS
FOR EACH ROW 
BEGIN
    UPDATE BOOK SET BOOK.AMOUNT_IN_STOCK = BOOK.AMOUNT_IN_STOCK + OLD.QUANTITY
    WHERE BOOK.ISBN = OLD.ISBN; 
END$$
    DELIMITER ;

    

insert INTO PUBLISHER values ('MN', 'DADAD', '010000000');    
insert into BOOK VALUES (12341, 'M', 'History', 2000, 'MN', 2020, 200, 900);
update BOOK SET THRESHOLD = 1000 WHERE ISBN = 12340;
INSERT INTO BOOK_ORDER VALUES(null ,12345, 200, curdate());
DROP trigger BOOK_BEFORE_UPDATE;
DELETE FROM ORDERS WHERE ID = 3;